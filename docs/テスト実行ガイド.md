# AI異常検知システム - テスト実行ガイド

## 概要
このドキュメントでは、AI異常検知システムのテスト実行方法について説明します。

## テストディレクトリ構成
```
tests/
├── __init__.py                 # テストパッケージ初期化
├── test_all.py                # 統合テストランナー
├── test_initialization.py     # システム初期化テスト
├── test_dataset.py           # データセット管理テスト
├── test_model.py             # モデル作成テスト
├── test_training.py          # 学習機能テスト
└── test_gui.py               # GUIアプリケーションテスト
```

## テスト実行方法

### 1. 統合テスト（推奨）
すべてのテストを一括実行します：
```bash
python -m tests.test_all
```

### 2. 個別テスト実行

#### システム初期化テスト
```bash
python -m tests.test_initialization
```

#### データセット管理テスト
```bash
python -m tests.test_dataset
```

#### モデル作成テスト
```bash
python -m tests.test_model
```

#### 学習機能テスト
```bash
python -m tests.test_training
```

#### GUIアプリケーションテスト
```bash
python -m tests.test_gui
```

## テスト内容

### 1. 初期化テスト (`test_initialization.py`)
- データセット管理の初期化
- 学習管理の初期化
- 基本的なシステムコンポーネントの動作確認

### 2. データセットテスト (`test_dataset.py`)
- MVTecデータセットの読み込み
- 画像ファイルの検出と分類
- データセット情報の取得

### 3. モデル作成テスト (`test_model.py`)
- anomalibモデル（Padim）の作成
- モデルパラメータの確認
- 事前学習済みモデルの処理

### 4. 学習機能テスト (`test_training.py`)
- データセット準備
- モデル作成
- データモジュール作成
- 学習開始可能性チェック

### 5. GUIアプリケーションテスト (`test_gui.py`)
- 学習アプリケーションの初期化
- 推論アプリケーションの初期化
- コアコンポーネントの初期化確認

## 期待される結果

### 成功時の出力例
```
============================================================
 AI異常検知システム - 統合テストスイート
============================================================
...
============================================================
 テスト結果サマリー
============================================================
initialization : 成功
dataset        : 成功
model          : 成功
training       : 成功
gui            : 成功
------------------------------------------------------------
総合結果: 全テスト成功
============================================================
```

### エラー発生時の対処

#### データセット関連エラー
- MVTecデータセットが正しくダウンロードされているか確認
- データセットパスの設定を確認

#### モデル関連エラー
- 必要なライブラリ（anomalib, torch）がインストールされているか確認
- メモリ不足の場合はバッチサイズを調整

#### GUI関連エラー
- tkinterが正しくインストールされているか確認
- Windowsの場合、GUI表示権限を確認

## テスト環境要件

### 必要なソフトウェア
- Python 3.8-3.11
- anomalib 2.1.0+
- PyTorch
- OpenVINO
- tkinter（GUI用）

### ハードウェア要件
- CPU: Intel/AMD x86_64
- メモリ: 4GB以上推奨
- ストレージ: 2GB以上の空き容量

### データ要件
- MVTecデータセットがダウンロード済み
- `datasets/development/mvtec_anomaly_detection/` にデータが配置

## トラブルシューティング

### よくある問題と解決方法

1. **インポートエラー**
   ```
   ModuleNotFoundError: No module named 'xxx'
   ```
   - 必要なライブラリをインストール：`pip install -r requirements.txt`

2. **データセットエラー**
   ```
   データセット情報の取得に失敗しました
   ```
   - MVTecデータセットの再ダウンロード
   - データセットパスの確認

3. **メモリ不足エラー**
   ```
   OutOfMemoryError
   ```
   - システムメモリの確認
   - 他のアプリケーションを終了

4. **GUI表示エラー**
   ```
   TclError: couldn't connect to display
   ```
   - GUI環境の確認
   - リモート接続の場合はX11転送設定

## 継続的インテグレーション（CI）

### GitHub Actionsでの実行例
```yaml
name: Test
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.9
    - name: Install dependencies
      run: pip install -r requirements.txt
    - name: Run tests
      run: python -m tests.test_all
```

## 注意事項

- テストは開発環境での実行を想定しています
- 本番環境でのテスト実行は慎重に行ってください
- 大量のデータ処理を伴うため、十分な時間を確保してください
- ログファイルは自動的に生成されます（`logs/` ディレクトリ）